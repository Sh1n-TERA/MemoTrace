<div class="memo-form-container">
  <%= form_with(model: @memo, local: true, id: "new_memo_form") do |form| %>
    <div class="mode-tabs">
      <button type="button" class="tab-button active" data-mode="normal">通常メモ</button>
      <button type="button" class="tab-button" data-mode="error">エラー記録</button>
    </div>

    <div class="form-card">
      <div id="normal-mode-fields">
        <div class="field">
          <%= form.label :title, 'タイトル' %>
          <%= form.text_field :title, placeholder: "タイトルを入力..." %>
        </div>

        <div class="field">
          <%= form.label :content, '内容' %>
          <%= form.text_area :content, placeholder: "内容を入力..." %>
        </div>
      </div>

      <div id="error-mode-fields" style="display:none;">
        <div class="field">
          <%= form.label :error_content, 'エラー内容' %>
          <%= form.text_area :error_content, placeholder: "エラー内容を入力..." %>
        </div>

        <div class="field">
          <%= form.label :cause, '原因' %>
          <%= form.text_area :cause, placeholder: "原因を入力..." %>
        </div>

        <div class="field">
          <%= form.label :solution, '解決策' %>
          <%= form.text_area :solution, placeholder: "解決策を入力..." %>
        </div>
      </div>

      <div class="field">
        <%= form.label :tag, 'タグ' %>
        <%= form.text_field :tag, placeholder: "タグを入力 (例: #HTML #)" %>
      </div>

      <div class="field">
        <%= form.label :image, '画像添付' %>
        <div class="image-upload-area">
          <%= form.file_field :image, class: "image-input" %>
          <p>画像を添付</p>
        </div>
      </div>
      
      <%= form.hidden_field :mode, value: 'normal', id: 'memo-mode' %>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('turbo:load', () => {
    const tabButtons = document.querySelectorAll('.tab-button');
    const normalFields = document.getElementById('normal-mode-fields');
    const errorFields = document.getElementById('error-mode-fields');
    const memoModeInput = document.getElementById('memo-mode');

    tabButtons.forEach(button => {
      button.addEventListener('click', (event) => {
        // すべてのタブボタンから'active'クラスを削除
        tabButtons.forEach(btn => btn.classList.remove('active'));

        // クリックされたボタンに'active'クラスを追加
        event.target.classList.add('active');

        // 選択されたモードを取得
        const selectedMode = event.target.dataset.mode;
        memoModeInput.value = selectedMode;

        // モードに応じてフォームの表示を切り替え
        if (selectedMode === 'normal') {
          normalFields.style.display = 'block';
          errorFields.style.display = 'none';
        } else if (selectedMode === 'error') {
          normalFields.style.display = 'none';
          errorFields.style.display = 'block';
        }
      });
    });
  });
</script>